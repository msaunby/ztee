<html>
<head>
  <title>tones</title>
</head>
<body>

<!--  <button onclick="TogetherJS(this); return false;">Start TogetherJS</button>
-->
<table>
  <tr>
    	<td><button id="one" class="beginDial" onmousedown="dialTone(697.0, 1209.0)"  onmouseup="stop()" data-freq='697.0, 1209.0'>1</button></td>
        <td><button id="two" class="beginDial" onmousedown="dialTone(697.0, 1336.0)" onmouseup="stop()" data-freq='697.0, 1336.0'>2</button></td>
        <td><button id="three" class="beginDial" onmousedown="dialTone(697.0, 1477.0)" onmouseup="stop()" data-freq='697.0, 1477.0'>3</button></td>
        <td><button id="dtmf-a" class="beginDial" onmousedown="dialTone(697.0, 1633.0)" onmouseup="stop()" data-freq='697.0, 1633.0'>A</button></td>
    </tr>
    <tr>
    	<td><button id="four" class="beginDial" onmousedown="dialTone(770.0, 1209.0)" onmouseup="stop()" data-freq='770.0, 1209.0'>4</button></td>
        <td><button id="five" class="beginDial" onmousedown="dialTone(770.0, 1336.0)" onmouseup="stop()" data-freq='770.0, 1336.0'>5</button></td>
        <td><button id="six" class="beginDial" onmousedown="dialTone(770.0, 1477.0)" onmouseup="stop()" data-freq='770.0, 1477.0'>6</button></td>
        <td><button id="dtmf-b" class="beginDial" onmousedown="dialTone(770.0, 1633.0)" onmouseup="stop()" data-freq='770.0, 1633.0'>B</button></td>
    </tr>
	<tr>
    	<td><button id="seven" class="beginDial" onmousedown="dialTone(852.0, 1209.0)" onmouseup="stop()" data-freq='852.0, 1209.0'>7</button></td>
        <td><button id="eight" class="beginDial" onmousedown="dialTone(852.0, 1336.0)" onmouseup="stop()" data-freq='852.0, 1336.0'>8</button></td>
        <td><button id="nine" class="beginDial" onmousedown="dialTone(852.0, 1477.0)" onmouseup="stop()" data-freq='852.0, 1477.0'>9</button></td>
        <td><button id="dtmf-c" class="beginDial" onmousedown="dialTone(852.0, 1633.0)" onmouseup="stop()" data-freq='852.0, 1633.0'>C</button></td>

    </tr>
	<tr>
    	<td><button class="beginDial" onmousedown="dialTone(941.0, 1209.0)" onmouseup="stop()" data-freq='941.0, 1209.0'>*</button></td>
        <td><button id="zero" class="beginDial" onmousedown="dialTone(941.0, 1336.0)" onmouseup="stop()" data-freq='941.0, 1336.0'>0</button></td>
        <td><button class="beginDial" onmousedown="dialTone(941.0, 1477.0)" onmouseup="stop()" data-freq='941.0, 1477.0'>#</button></td>
        <td><button id="dtmf-d" class="beginDial" onmousedown="dialTone(941.0, 1633.0)" onmouseup="stop()" data-freq='941.0, 1633.0'>D</button></td>

    </tr>
</table>
  <button id="test">test</button>

  <br>
  <input id="x" type="text" value="nil"></input>
  <br>
  <input id="y" type="text" value="nil"></input>
  <br>
  <input id="z" type="text" value="nil"></input>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <!-- togetherjs -->
      <script>
        TogetherJSConfig_findRoom = {prefix: "ztee", max: 3};
        TogetherJSConfig_autoStart = true;
        TogetherJSConfig_suppressJoinConfirmation = true;
        TogetherJSConfig_storagePrefix = "tjs_ztee";
      </script>
  <script src="https://togetherjs.com/togetherjs-min.js"></script>
  <script src="adapter.js"></script>
  <script>

  var pulse = true;
  var beat_orientation = false;
  var recordfn = function(){};

  function heartbeat(){
    setTimeout( function() {
      heartbeat();
      pulse = !pulse;
      beat_orientation = true;
      if(pulse){
        $('#test').css('background-color', 'red');
      }else{
        $('#test').css('background-color', 'white');
      }
    }, 500 );
  }

  heartbeat();

  var AudioContext = window.AudioContext || window.webkitAudioContext;
  var context = new AudioContext();

  var oscillator1, oscillator2;

  var dialTone = function(freq1, freq2){

    oscillator1 = context.createOscillator();
    oscillator1.type = 'sine';
    oscillator1.frequency.value = freq1;
    gainNode = context.createGain ? context.createGain() : context.createGainNode();
    oscillator1.connect(gainNode,0,0);
    gainNode.connect(context.destination);
    gainNode.gain.value = .1;
    oscillator1.start ? oscillator1.start(0) : oscillator1.noteOn(0)

    oscillator2 = context.createOscillator();
    oscillator2.type = 'sine';
    oscillator2.frequency.value = freq2;
    gainNode = context.createGain ? context.createGain() : context.createGainNode();
    oscillator2.connect(gainNode);
    gainNode.connect(context.destination);

    gainNode.gain.value = .1;
    oscillator2.start ? oscillator2.start(0) : oscillator2.noteOn(0)

  };

  function start() {
    if (typeof oscillator1 != 'undefined') oscillator1.disconnect();
    if (typeof oscillator2 != 'undefined') oscillator2.disconnect();
    oscOn(parseFloat(document.getElementById("freq").value),parseFloat(document.getElementById("freq2").value));
  }


  function stop() {
    oscillator1.disconnect();
    oscillator2.disconnect();
  }


  TogetherJS.hub.on("cursor-click", function (msg) {
    if (! msg.sameUrl) {
      console.log("MSG cursor-click SAME URL");
      return;
    }
    console.log("MSG cursor-click");
  });

  function handleOrientation(event) {
    if(beat_orientation){
      beat_orientation = false;
      if (TogetherJS.running) {
        TogetherJS.send({
          type: 'orientation',
          alpha: event.alpha,
          beta: event.beta,
          gamma: event.gamma
        });
      }
      var x = event.beta;  // In degree in the range [-180,180]
      var y = event.gamma; // In degree in the range [-90,90]
      var z = event.alpha; // In degree in the range [0,360]
      $('#x').val(x);
      $('#y').val(y);
      $('#z').val(z);
    }
  }

  window.addEventListener('deviceorientation', handleOrientation);

  $('#test').on("click", function(){
    console.log('Test clicked');
    if (TogetherJS.running) {
      TogetherJS.send({
        type: 'test-orientation',
        alpha: 12.4,
        beta: -11.2,
        gamma: 0.04
      });
    }
  });



TogetherJS.hub.on('orientation', function (msg) {
  if (!msg.sameUrl) {
    return;
  }
  var x = msg.beta;  // In degree in the range [-180,180]
  var y = msg.gamma; // In degree in the range [-90,90]
  var z = msg.alpha; // In degree in the range [0,360]
  $('#x').val(x);
  $('#y').val(y);
  $('#z').val(z);
  console.log(msg);
});

  </script>

</body>
</html>
